<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
  <title>Zappar — Smoke Test</title>
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #debug{position:fixed;left:10px;top:10px;color:#0f0;background:rgba(0,0,0,.5);padding:6px 8px;font:12px/1.2 monospace;border-radius:6px}
  </style>
  <!-- CDN зөвхөн -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js" defer></script>
  <script src="https://unpkg.com/@zappar/zappar-threejs@2.5.2/umd/zappar-threejs.js" defer></script>
</head>
<body>
  <div id="debug">booting…</div>
  <script>
    const dbg = m => document.getElementById('debug').textContent = 'DEBUG: ' + m;
    window.addEventListener('load', async () => {
      try{
        const { THREE, ZapparThree } = window;
        if(!THREE || !ZapparThree) throw new Error('libs not loaded');

        const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
        renderer.setSize(innerWidth, innerHeight);
        document.body.appendChild(renderer.domElement);
        ZapparThree.glContextSet(renderer.getContext());

        if (ZapparThree.browserIncompatible()) { ZapparThree.browserIncompatibleUI(); return; }

        const camera = new ZapparThree.Camera({ userFacing:false });
        const scene  = new THREE.Scene();
        scene.background = camera.backgroundTexture;

        const ok = await ZapparThree.permissionRequest();
        if(!ok){ ZapparThree.permissionDeniedUI(); return; }
        camera.start();
        dbg('zappar camera started');

        window.addEventListener('resize', ()=>renderer.setSize(innerWidth, innerHeight));
        renderer.setAnimationLoop(()=>{
          camera.updateFrame(renderer);
          renderer.render(scene, camera);
        });
      }catch(e){ dbg('ERR: '+e.message); alert(e.message); }
    });
  </script>
</body>
</html>
