<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
  <title>WebAR ‚Äî Intro‚Üí–ú–µ–Ω—é‚Üí–î–∞—Å–≥–∞–ª</title>
  <style>
    :root { --z-cam:0; --z-canvas:1; --z-video:2; --z-menu:3; --z-toast:4; }
    html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:system-ui,Arial}
    /* –ö–∞–º–µ—Ä (–∞—Ä—ã–Ω) */
    #cam{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;background:#000;z-index:var(--z-cam);transform:scaleX(-1)}
    /* Unity canvas (—Ö—ç—Ä—ç–≥–ª—ç–≤—ç–ª) */
    #unity-canvas{position:fixed;inset:0;width:100vw;height:100vh;background:transparent!important;z-index:var(--z-canvas);display:none}
    /* –ê–ª—å—Ñ–∞ –≤–∏–¥–µ–æ–Ω—É—É–¥ */
    .overlay{position:fixed;inset:0;width:100%;height:100%;object-fit:contain;background:transparent;display:none;z-index:var(--z-video)}
    /* –ú–µ–Ω—é */
    #menu{
      position:fixed;inset:0;display:flex;align-items:flex-end;justify-content:center;
      padding:28px; pointer-events:none; z-index:var(--z-menu);
      background:linear-gradient(to top, rgba(0,0,0,.5), rgba(0,0,0,0) 40%);
      animation: fadeIn .6s ease both;
    }
    .menu-inner{display:flex;gap:12px;pointer-events:auto;transform:translateY(15px);animation: slideUp .6s .1s ease both}
    .btn{
      padding:14px 18px;border:0;border-radius:14px;cursor:pointer;
      background:#ffffff; color:#111; font-weight:600; font-size:16px;
      box-shadow:0 8px 28px rgba(0,0,0,.25); transform:translateY(0); transition:transform .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    /* –ê–Ω–∏–º–∞—Ü–∏ */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    /* –ñ–∏–∂–∏–≥ —Å–∞–Ω—É—É–ª–≥–∞ (autoplay policy) */
    #toast{position:fixed;left:50%;top:18px;transform:translateX(-50%);z-index:var(--z-toast);
      background:rgba(0,0,0,.7);color:#fff;border-radius:10px;padding:10px 14px;font-size:13px;display:none}
  </style>
</head>
<body>
  <!-- –ö–∞–º–µ—Ä -->
  <video id="cam" playsinline autoplay muted></video>

  <!-- Unity canvas (—à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –±–æ–ª –∞—à–∏–≥–ª–∞–∂ –±–æ–ª–Ω–æ) -->
  <canvas id="unity-canvas"></canvas>

  <!-- –ê–ª—å—Ñ–∞ –≤–∏–¥–µ–æ–Ω—É—É–¥ -->
  <video id="intro" class="overlay" playsinline></video>
  <video id="exercise" class="overlay" playsinline loop></video>

  <!-- –ú–µ–Ω—é (intro –¥—É—É—Å—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ –≥–∞—Ä–Ω–∞) -->
  <div id="menu" style="display:none">
    <div class="menu-inner">
      <!-- –ñ–∏—à—ç—ç –Ω—ç–º—ç–ª—Ç —Ç–æ–≤—á–Ω—É—É–¥ (style “Ø–∑“Ø“Ø–ª—ç—Ö –∑–æ—Ä–∏–ª–≥–æ–æ—Ä) -->
      <button class="btn" id="btnInfo">–ú—ç–¥—ç—ç–ª—ç–ª</button>
      <button class="btn" id="btnGuide">–ó–∞–∞–≤–∞—Ä</button>
      <!-- –ì–æ–ª: –î–∞—Å–≥–∞–ª -->
      <button class="btn" id="btnExercise">–î–∞—Å–≥–∞–ª</button>
    </div>
  </div>

  <div id="toast">üîä –î—É—É–≥ –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª—ç—Ö–∏–π–Ω —Ç—É–ª–¥ –¥—ç–ª–≥—ç—Ü –¥—ç—ç—Ä –Ω—ç–≥ –¥–∞—Ä–Ω–∞ —É—É</div>

<script>
  // ================== –¢–ê–ù–´ –í–ò–î–ï–û URL-—É—É–¥ ==================
  const INTRO_URL    = "https://batbaatar-anu.github.io/my-ar-host/output_alpha_audio.webm";
  const EXERCISE_URL = "https://batbaatar-anu.github.io/my-ar-host/dasgal.webm";
  // iOS fallback (—à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –±–æ–ª –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª)
  // const INTRO_IOS    = "https://.../intro_alpha_hevc.mp4";    // type: video/mp4; codecs="hvc1"
  // const EXERCISE_IOS = "https://.../exercise_alpha_hevc.mp4"; // type: video/mp4; codecs="hvc1"

  const cam = document.getElementById('cam');
  const intro = document.getElementById('intro');
  const exercise = document.getElementById('exercise');
  const menu = document.getElementById('menu');
  const btnExercise = document.getElementById('btnExercise');
  const toast = document.getElementById('toast');

  // ===== –ö–∞–º–µ—Ä (–∞—Ä—ã–Ω) –∑”©–≤—à”©”©—Ä”©–ª ‚Üí —à—É—É–¥ –∞—Å–≥–∞—Ö
  async function startCamera(){
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:{ ideal:'environment' } }, audio:false
    });
    cam.srcObject = stream;
    await cam.play();
  }

  // ===== –í–∏–¥–µ–æ–Ω–¥ —ç—Ö —Å—É—Ä–≤–∞–ª–∂ –æ–Ω–æ–æ—Ö
  function setSources(videoEl, webmUrl /*, hevcUrl */){
    videoEl.innerHTML = "";
    const s1 = document.createElement('source');
    s1.src = webmUrl;
    s1.type = 'video/webm; codecs="vp8,opus"';
    videoEl.appendChild(s1);
    // // iOS fallback (HEVC + alpha)
    // if (hevcUrl){
    //   const s2 = document.createElement('source');
    //   s2.src = hevcUrl;
    //   s2.type = 'video/mp4; codecs="hvc1"';
    //   videoEl.appendChild(s2);
    // }
  }

  // ===== –ê–ª—Ö–º—É—É–¥: –Ω—ç—ç–≥–¥–º—ç–≥—Ü ‚Üí –∫–∞–º–µ—Ä ‚Üí intro ‚Üí –º–µ–Ω—é ‚Üí –¥–∞—Å–≥–∞–ª
  async function boot(){
    try{
      await startCamera();
    }catch(err){
      alert("–ö–∞–º–µ—Ä—ã–Ω –∑”©–≤—à”©”©—Ä”©–ª —Ö—ç—Ä—ç–≥—Ç—ç–π: " + err.message);
      return;
    }

    // Intro-–≥ “Ø—Ä–≥—ç–ª–∂ —Ç–æ–≥–ª—É—É–ª–Ω–∞ (–±–æ–ª–≥–æ–Ω–¥)
    setSources(intro, INTRO_URL /*, INTRO_IOS*/);
    intro.muted = false;           // –¥—É—É–≥ –æ—Ä–æ–ª–¥–æ–Ω–æ
    intro.currentTime = 0;
    intro.style.display = "block";

    // –ê—É–¥–∏–æ autoplay –±–ª–æ–∫–¥–æ—Ö –º–∞–≥–∞–¥–ª–∞–ª—Ç–∞–π ‚Äî —Ç—ç–≥–≤—ç–ª —Ç–∞–π–ª–±–∞—Ä –≥–∞—Ä–≥–∞–∞–¥, –Ω—ç–≥ —Ç–æ–≤—à–∏—Ö–æ–¥ –¥—É—É–≥ –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª–Ω—ç
    try{
      await intro.play();
    }catch(e){
      // Fallback: muted-—ç—ç—Ä —ç—Ö–ª“Ø“Ø–ª—ç—ç–¥, touch/–¥–∞—Ä—Å–∞–Ω “Ø–µ–¥ unmute —Ö–∏–π–Ω—ç
      toast.style.display = "block";
      intro.muted = true;
      intro.play().catch(()=>{});
      const enableAudio = ()=>{
        intro.muted = false;
        intro.volume = 1.0;
        toast.style.display = "none";
        document.removeEventListener('pointerdown', enableAudio, {passive:true});
      };
      document.addEventListener('pointerdown', enableAudio, {passive:true, once:true});
    }
  }

  // Intro –¥—É—É—Å–º–∞–≥—Ü ‚Äî –º–µ–Ω—é–≥ –∫–∞–º–µ—Ä—ã–Ω –¥—ç—ç—Ä –∞–Ω–∏–º—Ç–∞–π–≥–∞–∞—Ä –≥–∞—Ä–≥–∞–Ω–∞
  intro.addEventListener('ended', ()=>{
    intro.style.display = "none";
    menu.style.display = "flex";
  });

  // ‚Äú–î–∞—Å–≥–∞–ª‚Äù —Ç–æ–≤—á ‚Üí exercise alpha-–≥ –∫–∞–º–µ—Ä—ã–Ω –¥—ç—ç—Ä loop-—Ç–æ–π
  btnExercise.addEventListener('click', async ()=>{
    menu.style.display = "none";
    setSources(exercise, EXERCISE_URL /*, EXERCISE_IOS*/);
    exercise.muted = false; // –¥—É—É —è–≤—É—É–ª–∞—Ö—ã–≥ –æ—Ä–æ–ª–¥–æ–Ω–æ
    exercise.currentTime = 0;
    exercise.style.display = "block";
    try{
      await exercise.play();
    }catch(e){
      toast.style.display = "block";
      exercise.muted = true;
      exercise.play().catch(()=>{});
      const enableAudio2 = ()=>{
        exercise.muted = false;
        exercise.volume = 1.0;
        toast.style.display = "none";
        document.removeEventListener('pointerdown', enableAudio2, {passive:true});
      };
      document.addEventListener('pointerdown', enableAudio2, {passive:true, once:true});
    }
  });

  // –°—Ç–∞—Ä—Ç
  window.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
